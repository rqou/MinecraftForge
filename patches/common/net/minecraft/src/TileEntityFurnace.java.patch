--- ../src_base/common/net/minecraft/src/TileEntityFurnace.java
+++ ../src_work/common/net/minecraft/src/TileEntityFurnace.java
@@ -1,11 +1,15 @@
 package net.minecraft.src;
 
+import net.minecraftforge.common.ISidedInventory;
+import net.minecraftforge.common.ISpecialInventory;
+import net.minecraftforge.common.Orientation;
+import net.minecraftforge.common.StackUtil;
 import cpw.mods.fml.common.registry.GameRegistry;
 
 import cpw.mods.fml.common.Side;
 import cpw.mods.fml.common.asm.SideOnly;
 
-public class TileEntityFurnace extends TileEntity implements IInventory
+public class TileEntityFurnace extends TileEntity implements IInventory, ISidedInventory, ISpecialInventory
 {
     /**
      * The ItemStacks that hold the items currently being used in the furnace
@@ -235,8 +239,7 @@
 
                         if (this.furnaceItemStacks[1].stackSize == 0)
                         {
-                            Item var3 = this.furnaceItemStacks[1].getItem().getContainerItem();
-                            this.furnaceItemStacks[1] = var3 != null ? new ItemStack(var3) : null;
+                            this.furnaceItemStacks[1] = this.furnaceItemStacks[1].getItem().getContainerItemStack(furnaceItemStacks[1]);
                         }
                     }
                 }
@@ -282,8 +285,12 @@
         }
         else
         {
-            ItemStack var1 = FurnaceRecipes.smelting().getSmeltingResult(this.furnaceItemStacks[0].getItem().shiftedIndex);
-            return var1 == null ? false : (this.furnaceItemStacks[2] == null ? true : (!this.furnaceItemStacks[2].isItemEqual(var1) ? false : (this.furnaceItemStacks[2].stackSize < this.getInventoryStackLimit() && this.furnaceItemStacks[2].stackSize < this.furnaceItemStacks[2].getMaxStackSize() ? true : this.furnaceItemStacks[2].stackSize < var1.getMaxStackSize())));
+            ItemStack var1 = FurnaceRecipes.smelting().getSmeltingResult(this.furnaceItemStacks[0]);
+            if (var1 == null) return false;
+            if (this.furnaceItemStacks[2] == null) return true;
+            if (!this.furnaceItemStacks[2].isItemEqual(var1)) return false;
+            int result = furnaceItemStacks[2].stackSize + var1.stackSize;
+            return (result <= getInventoryStackLimit() && result <= var1.getMaxStackSize());
         }
     }
 
@@ -294,15 +301,15 @@
     {
         if (this.canSmelt())
         {
-            ItemStack var1 = FurnaceRecipes.smelting().getSmeltingResult(this.furnaceItemStacks[0].getItem().shiftedIndex);
+            ItemStack var1 = FurnaceRecipes.smelting().getSmeltingResult(this.furnaceItemStacks[0]);
 
             if (this.furnaceItemStacks[2] == null)
             {
                 this.furnaceItemStacks[2] = var1.copy();
             }
-            else if (this.furnaceItemStacks[2].itemID == var1.itemID)
-            {
-                ++this.furnaceItemStacks[2].stackSize;
+            else if (this.furnaceItemStacks[2].isItemEqual(var1))
+            {
+                furnaceItemStacks[2].stackSize += var1.stackSize;
             }
 
             --this.furnaceItemStacks[0].stackSize;
@@ -329,7 +336,7 @@
             int var1 = par0ItemStack.getItem().shiftedIndex;
             Item var2 = par0ItemStack.getItem();
 
-            if (var1 < 256 && Block.blocksList[var1] != null)
+            if (par0ItemStack.getItem() instanceof ItemBlock && Block.blocksList[var1] != null)
             {
                 Block var3 = Block.blocksList[var1];
 
@@ -374,4 +381,106 @@
     public void openChest() {}
 
     public void closeChest() {}
+
+    @Override
+    public int getStartInventorySide(Orientation side)
+    {
+        if (side == Orientation.DOWN) return 1;
+        if (side == Orientation.UP) return 0; 
+        return 2;
+    }
+
+    @Override
+    public int getSizeInventorySide(Orientation side)
+    {
+        return 1;
+    }
+
+    @Override
+    public int addItem(ItemStack stack, boolean doAdd, Orientation from)
+    {
+        if(from == Orientation.DOWN && !TileEntityFurnace.isItemFuel(stack))
+            return 0;
+        
+        if(from == Orientation.UP && FurnaceRecipes.smelting().getSmeltingResult(stack) == null)
+            return 0;
+        
+        if(from != Orientation.UP && from != Orientation.DOWN)
+            return 0;
+        
+        StackUtil stackUtil = new StackUtil(stack);
+        boolean added = false;
+        
+        int start = getStartInventorySide(from);
+        int end = start + getSizeInventorySide(from);
+
+        for(int i = start; i < end; i++)
+        {
+            if(stackUtil.tryAdding(this, i, doAdd, false))
+            {
+                added = true;
+                break;
+            }
+        }
+
+        if(added)
+        {
+            if(!doAdd)
+                return stackUtil.itemsAdded;
+            else
+            {
+                while(stack.stackSize - stackUtil.itemsAdded > 0)
+                    stackUtil.tryAdding(this, 3, true, false);
+
+                return stackUtil.itemsAdded;
+            }
+        }
+        
+        if(!added)
+        {
+            for(int i = start; i < end; i++)
+            {
+                if(stackUtil.tryAdding(this, i, doAdd, true))
+                {
+                    added = true;
+                    break;
+                }
+            }
+        }
+
+        if(added)
+        {
+            if(!doAdd)
+                return stackUtil.itemsAdded;
+            else
+            {
+                while(stack.stackSize - stackUtil.itemsAdded > 0)
+                    stackUtil.tryAdding(this, 3, true, true);
+
+                return stackUtil.itemsAdded;
+            }
+        }
+        
+        return 0;
+    }
+
+    @Override
+    public ItemStack[] extractItem(boolean doRemove, Orientation from, int maxItemCount)
+    {
+        int start = getStartInventorySide(from);
+        int end = start + getSizeInventorySide(from);
+        
+        for(int i = start; i < end; i++)
+        {
+            if(furnaceItemStacks[i] != null)
+            {
+                if(doRemove)
+                    return new ItemStack[] { decrStackSize(i, 1) };
+                else
+                    return new ItemStack[] { furnaceItemStacks[i] };
+            }
+        }
+        
+        return null;
+    }
 }
